import { useState } from 'react'
import { Meta, Story, Canvas } from '@storybook/addon-docs/blocks'

<Meta title="Hooks/useEntity"/>

# useEntity

This is the basic hook on which we plan to build all our future hooks. But this does not mean that it cannot be used directly. Here's a simple example of how you can use it:

```js
const fetchFn = () => fetch('/something')

const { isLoading, data, fetchMore, canFetchMore } = useEntity(
    'ESomething',
    fetchFn,
    props
)
```

**More examples:**
* Basic [useUserBalanceEntity](/?path=/docs/entities-userbalance--default-story)
* Advanced [usePerformersEntity](/?path=/docs/entities-messengerthreads--default-story)


key,
    fetchFn,
    {
        reducer = defaultReducer,
        selector = defaultSelector,
        initialData = () => null,
        getFetchMore = () => false,
        dataMapper = v => v,
        skip = false,
        options: externalOptions = {}
    }

### Options
* `key: string` - entity key. Can be any string but usually we use something like ESomething, EWhatever, etc.
* `fetchFn: Function` - any promise which will return your data.
* `properties: Properties` - object with properties.


### Properties
* `reducer: Function` - classical redux reducer.
* `selector: Function` - selector to select data from the store.
* `initialData: Function` - if set, this value will be used as the initial data for the entity.
* `getFetchMore = () => boolean | object` function to generate fetch options to fetchMore function.
    * When new data is received for this entity, this function receives last options, last fetch result of the infinite list of data and the full array of all chunks.
    * Return `false` to indicate there is no next page available.
* `dataMapper: Function` - data mapper function. It will prepare your data before showing it somewhere.
* `skip: boolean`
    * Set this to **true** to disable this entity from automatically running.
    * Can be used for dependent entities.
* `cache: string`
    * 'no-cache' - try to fetch on the first usage of the hook.
    * 'cache-first' - get data from the cache and if there is not cache fetch it.
* `options: Record<string, unknown>` - will be passed into fetch, fetchMore, refetch  function and selector as a second argument.

### Returns

* `data`
    * Defaults to `undefined`.
    * The last successfully resolved data for the entity.
* `isLoading: boolean` - Will be true if the entity is currently fetching.
* `isRefetch: Function` - A function to manually refetch the entity.
* `mappedData: Record<string, unknown>` - Prepared ( by dataMapper option ) data.
* `refetch: Function`
* `fetchMore: Function` - A function to manually fetchMore the entity with additional request options. Example:
```js
fetchMore({ searchParams: { offset: 10, limit: 10 } }).then(res => console.log)
fetchMore(prev => ({ searchParams: { offset: prev.searchParams.offset + 10, limit: 10 } })).then(res => console.log)
```
* `error: null | any` - Will have error object if something goes wrong if not then it will be null.
* `isError: boolean` - has some errors or not.
* `canFetchMore: boolean`
